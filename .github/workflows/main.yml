name: Post JSON File to Two Tandem Streams

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:
  post_json:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Debug â€“ check stream.json
        run: |
          echo "Current directory:"
          pwd
          echo "Files:"
          ls -la
          echo "Contents of stream.json:"
          cat stream.json

      - name: Post to Tandem Stream 1
        run: |
          curl --fail-with-body -X POST \
            "https://tandem.autodesk.com/api/v1/timeseries/models/urn:adsk.dtm:nJH85NjvTGGcGaJ6R3tyVg/streams/AQAAAAVsqX42Kki0p6md8TCWHtcAAAAA" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.TANDEM_TOKEN_1 }}" \
            --data-binary @stream.json

      - name: Post to Tandem Stream 2
        run: |
          curl --fail-with-body -X POST \
            "https://tandem.autodesk.com/api/v1/timeseries/models/urn:adsk.dtm:nJH85NjvTGGcGaJ6R3tyVg/streams/AQAAAGIOnr0upUqDg42IKQQ1gp4AAAAA" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.TANDEM_TOKEN_2 }}" \
            --data-binary @stream.json
